generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["nativeTypes"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL_DEV")
}

model Admin {
  userId Int  @id @map(name: "user_id") @db.UnsignedInt
  user   User @relation(fields: [userId], references: [id])

  @@map(name: "admin")
}

model CafeteriaMenu {
  campus   String   @db.Char(2)
  servedAt DateTime @map(name: "served_at") @db.Date
  data     Json?    @db.Json

  @@id([campus, servedAt])
  @@map(name: "cafeteria_menu")
}

model ChangePassword {
  userId      Int      @id @map(name: "user_id") @db.UnsignedInt
  token       String   @unique @db.VarChar(40)
  requestedAt DateTime @map(name: "requested_at") @db.DateTime(0)
  user        User     @relation(fields: [userId], references: [id])

  @@index([token], name: "change_password_token")
  @@map(name: "change_password")
}

model CommunityBoard {
  id                 Int                 @id @default(autoincrement()) @db.UnsignedInt
  name               String              @default("") @db.VarChar(50)
  description        String?             @db.VarChar(100)
  priority           Int                 @default(0) @db.UnsignedSmallInt
  isDeleted          Boolean             @default(false) @map(name: "is_deleted") @db.TinyInt
  createdBy          Int                 @map(name: "created_by") @db.UnsignedInt
  createdAt          DateTime            @map(name: "created_at") @db.DateTime(0)
  activeAt           DateTime?           @map(name: "active_at") @db.DateTime(0)
  user               User                @relation(fields: [createdBy], references: [id])
  communityBoardPins CommunityBoardPin[]
  communityPosts     CommunityPost[]

  @@index([createdBy], name: "created_by")
  @@map(name: "community_board")
}

model CommunityBoardCandidate {
  id                           Int                           @id @default(autoincrement()) @db.UnsignedInt
  name                         String                        @default("") @db.VarChar(50)
  description                  String?                       @db.VarChar(100)
  createdBy                    Int                           @map(name: "created_by") @db.UnsignedInt
  createdAt                    DateTime                      @map(name: "created_at") @db.DateTime(0)
  user                         User                          @relation(fields: [createdBy], references: [id])
  communityBoardCandidateVotes CommunityBoardCandidateVote[]

  @@index([createdBy], name: "created_by")
  @@map(name: "community_board_candidate")
}

model CommunityBoardCandidateVote {
  boardCandidateId        Int                     @map(name: "board_candidate_id") @db.UnsignedInt
  userId                  Int                     @map(name: "user_id") @db.UnsignedInt
  communityBoardCandidate CommunityBoardCandidate @relation(fields: [boardCandidateId], references: [id])
  user                    User                    @relation(fields: [userId], references: [id])

  @@id([boardCandidateId, userId])
  @@index([userId], name: "user_id")
  @@map(name: "community_board_candidate_vote")
}

model CommunityBoardPin {
  userId         Int            @map(name: "user_id") @db.UnsignedInt
  boardId        Int            @map(name: "board_id") @db.UnsignedInt
  communityBoard CommunityBoard @relation(fields: [boardId], references: [id])
  user           User           @relation(fields: [userId], references: [id])

  @@id([userId, boardId])
  @@index([boardId], name: "board_id")
  @@map(name: "community_board_pin")
}

model CommunityComment {
  id                   Int                   @id @default(autoincrement()) @db.UnsignedInt
  postId               Int                   @map(name: "post_id") @db.UnsignedInt
  userId               Int                   @map(name: "user_id") @db.UnsignedInt
  randomNickname       String                @default("") @map(name: "random_nickname") @db.VarChar(30)
  body                 String                @db.Text
  commentedAt          DateTime              @map(name: "commented_at") @db.DateTime(0)
  isDeleted            Boolean               @default(false) @map(name: "is_deleted") @db.TinyInt
  communityPost        CommunityPost         @relation(fields: [postId], references: [id])
  user                 User                  @relation(fields: [userId], references: [id])
  communitySubcomments CommunitySubcomment[]

  @@index([postId], name: "post_id")
  @@index([userId], name: "user_id")
  @@map(name: "community_comment")
}

model CommunityPost {
  id                     Int                     @id @default(autoincrement()) @db.UnsignedInt
  boardId                Int                     @map(name: "board_id") @db.UnsignedInt
  userId                 Int                     @map(name: "user_id") @db.UnsignedInt
  title                  String                  @db.VarChar(100)
  body                   String                  @db.Text
  randomNickname         String                  @map(name: "random_nickname") @db.VarChar(30)
  likesCount             Int                     @default(0) @map(name: "likes_count") @db.UnsignedMediumInt
  commentsCount          Int                     @default(0) @map(name: "comments_count") @db.UnsignedMediumInt
  bookmarksCount         Int                     @default(0) @map(name: "bookmarks_count") @db.UnsignedMediumInt
  postedAt               DateTime                @map(name: "posted_at") @db.DateTime(0)
  editedAt               DateTime?               @map(name: "edited_at") @db.DateTime(0)
  isDeleted              Boolean                 @default(false) @map(name: "is_deleted") @db.TinyInt
  communityBoard         CommunityBoard          @relation(fields: [boardId], references: [id])
  user                   User                    @relation(fields: [userId], references: [id])
  communityComments      CommunityComment[]
  communityPostBookmarks CommunityPostBookmark[]
  communityPostLikes     CommunityPostLike[]
  communitySubcomments   CommunitySubcomment[]

  @@index([boardId], name: "board_id")
  @@index([userId], name: "user_id")
  @@map(name: "community_post")
}

model CommunityPostBookmark {
  userId        Int           @map(name: "user_id") @db.UnsignedInt
  postId        Int           @map(name: "post_id") @db.UnsignedInt
  communityPost CommunityPost @relation(fields: [postId], references: [id])
  user          User          @relation(fields: [userId], references: [id])

  @@id([userId, postId])
  @@index([postId], name: "post_id")
  @@map(name: "community_post_bookmark")
}

model CommunityPostLike {
  userId        Int           @map(name: "user_id") @db.UnsignedInt
  postId        Int           @map(name: "post_id") @db.UnsignedInt
  communityPost CommunityPost @relation(fields: [postId], references: [id])
  user          User          @relation(fields: [userId], references: [id])

  @@id([userId, postId])
  @@index([postId], name: "post_id")
  @@map(name: "community_post_like")
}

model CommunitySubcomment {
  id               Int              @id @default(autoincrement()) @db.UnsignedInt
  userId           Int              @map(name: "user_id") @db.UnsignedInt
  postId           Int              @map(name: "post_id") @db.UnsignedInt
  commentId        Int              @map(name: "comment_id") @db.UnsignedInt
  randomNickname   String           @default("") @map(name: "random_nickname") @db.VarChar(30)
  body             String           @db.Text
  subcommentedAt   DateTime         @map(name: "subcommented_at") @db.DateTime(0)
  isDeleted        Boolean          @default(false) @map(name: "is_deleted") @db.TinyInt
  communityComment CommunityComment @relation(fields: [commentId], references: [id])
  communityPost    CommunityPost    @relation(fields: [postId], references: [id])
  user             User             @relation(fields: [userId], references: [id])

  @@index([commentId], name: "comment_id")
  @@index([postId], name: "post_id")
  @@index([userId], name: "user_id")
  @@map(name: "community_subcomment")
}

model CoverageMajor {
  coverageCollege       String?                @map(name: "coverage_college") @db.VarChar(50)
  name                  String                 @db.VarChar(50)
  code                  String                 @id @db.VarChar(20)
  coverageMajorLectures CoverageMajorLecture[]

  @@map(name: "coverage_major")
}

model CoverageMajorLecture {
  lectureId     String        @map(name: "lecture_id") @db.Char(36)
  majorCode     String        @map(name: "major_code") @db.VarChar(20)
  lecture       Lecture       @relation(fields: [lectureId], references: [id])
  coverageMajor CoverageMajor @relation(fields: [majorCode], references: [code])

  @@id([lectureId, majorCode])
  @@index([lectureId], name: "coverage_major_lecture_lecture_id")
  @@index([majorCode], name: "coverage_major_lecture_major_code")
  @@map(name: "coverage_major_lecture")
}

model Lecture {
  id                    String                 @id @db.Char(36)
  year                  Int?                   @db.SmallInt
  semester              String?                @db.VarChar(10)
  campus                String?                @db.VarChar(10)
  college               String?                @db.VarChar(50)
  major                 String?                @db.VarChar(50)
  grade                 Int?                   @db.TinyInt
  credit                Int?                   @db.TinyInt
  course                String?                @db.VarChar(50)
  section               String?                @db.VarChar(50)
  code                  String?                @db.VarChar(50)
  name                  String?                @db.VarChar(100)
  professor             String?                @db.VarChar(50)
  schedule              String?                @db.VarChar(150)
  building              Int?                   @db.SmallInt
  room                  String?                @db.VarChar(20)
  note                  String?                @db.Text
  coverageMajorLectures CoverageMajorLecture[]
  periods               Period[]

  @@map(name: "lecture")
}

model LiveChat {
  id             Int      @default(autoincrement()) @db.Int
  message        String   @db.VarChar(100)
  createdAt      DateTime @map(name: "created_at") @db.DateTime(0)
  userId         Int      @map(name: "user_id") @db.UnsignedInt
  randomNickname String   @map(name: "random_nickname") @db.VarChar(30)
  user           User     @relation(fields: [userId], references: [id])

  @@id([id, userId])
  @@index([userId], name: "user_id")
  @@map(name: "live_chat")
}

model NoticeNotificationsSubscription {
  id           Int      @id @default(autoincrement()) @db.UnsignedInt
  userId       Int      @map(name: "user_id") @db.UnsignedInt
  noticeKey    String   @map(name: "notice_key") @db.VarChar(255)
  subscribedAt DateTime @map(name: "subscribed_at") @db.DateTime(0)
  user         User     @relation(fields: [userId], references: [id])

  @@index([noticeKey], name: "notice_notifications_subscription_notice_key")
  @@index([userId], name: "user_id")
  @@map(name: "notice_notifications_subscription")
}

model PendingUser {
  id             Int      @id @default(autoincrement()) @db.UnsignedInt
  portalId       String   @unique @map(name: "portal_id") @db.VarChar(320)
  password       String   @db.Char(60)
  nickname       String   @unique @db.VarChar(30)
  randomNickname String   @map(name: "random_nickname") @db.VarChar(30)
  joinedAt       DateTime @map(name: "joined_at") @db.DateTime(0)
  token          String   @unique @db.VarChar(40)

  @@map(name: "pending_user")
}

model Period {
  lectureId String  @map(name: "lecture_id") @db.Char(36)
  day       String  @db.Char(3)
  startH    Int     @map(name: "start_h") @db.TinyInt
  startM    Int     @map(name: "start_m") @db.TinyInt
  endH      Int     @map(name: "end_h") @db.TinyInt
  endM      Int     @map(name: "end_m") @db.TinyInt
  lecture   Lecture @relation(fields: [lectureId], references: [id])

  @@id([lectureId, day, startH, startM, endH, endM])
  @@index([lectureId], name: "period_lecture_id")
  @@map(name: "period")
}

model Push {
  userId        Int       @map(name: "user_id") @db.UnsignedInt
  expoPushToken String    @id @default("") @map(name: "expo_push_token") @db.VarChar(255)
  registeredAt  DateTime  @map(name: "registered_at") @db.DateTime(0)
  activeAt      DateTime? @map(name: "active_at") @db.DateTime(0)
  user          User      @relation(fields: [userId], references: [id])

  @@index([userId], name: "user_id")
  @@map(name: "push")
}

model User {
  id                               Int                               @id @default(autoincrement()) @db.UnsignedInt
  portalId                         String                            @unique @map(name: "portal_id") @db.VarChar(320)
  password                         String                            @db.Char(60)
  nickname                         String                            @unique @db.VarChar(30)
  randomNickname                   String                            @map(name: "random_nickname") @db.VarChar(30)
  joinedAt                         DateTime                          @map(name: "joined_at") @db.DateTime(0)
  refreshToken                     String?                           @map(name: "refresh_token") @db.VarChar(500)
  admin                            Admin?
  changePassword                   ChangePassword?
  communityBoards                  CommunityBoard[]
  communityBoardCandidates         CommunityBoardCandidate[]
  communityBoardCandidateVotes     CommunityBoardCandidateVote[]
  communityBoardPins               CommunityBoardPin[]
  communityComments                CommunityComment[]
  communityPosts                   CommunityPost[]
  communityPostBookmarks           CommunityPostBookmark[]
  communityPostLikes               CommunityPostLike[]
  communitySubcomments             CommunitySubcomment[]
  liveChats                        LiveChat[]
  noticeNotificationsSubscriptions NoticeNotificationsSubscription[]
  pushes                           Push[]

  @@map(name: "user")
}
